<!DOCTYPE HTML>
<html>
 <head>
  <meta content="IE=Edge" http-equiv="X-UA-Compatible"/>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
   <meta content="zh-cn" http-equiv="Content-Language"/>
   <title>
    QTREE6 【树状数组】【倍增祖先】
   </title>
   <base href="//qzs.qzone.qq.com/"/>
  </meta>
 </head>
 <body>
  <div class="bg_mode bg">
   <div class="box_ml bor">
    <div class="mode_gb">
     <div class="mode_gb_title bg2">
      <div class="bg_mode_gb_title">
       <h3>
        日志
       </h3>
      </div>
      <div class="mode_gb_other">
       <p>
        <a class="c_tx" href="javascript:void(0)" id="returnListArea" rel="returnBlogList" title="返回日志列表">
         返回日志列表
        </a>
       </p>
      </div>
     </div>
     <div class="mode_gb_cont">
      <div class="blog_app" id="app_mod">
       <div class="blog_header">
        <div class="blog_title">
         <div class="blog_tit_cont clearfix" id="title">
          <strong>
           <span>
            <span class="blog_tit_detail">
             QTREE6 【树状数组】【倍增祖先】
            </span>
           </span>
          </strong>
          <span class="tit_other_info" style="display:inline;">
           <span class="c_tx3" id="pubTime">
            2015-06-28 20:00:38
           </span>
           <span class="c_tx3" id="readNum">
            éè¯»(113)	è¯è®º(0)
           </span>
           <span class="c_tx3" id="quoteInfo">
           </span>
          </span>
         </div>
        </div>
        <div class="operate_toolbar">
         <div class="mod_interactive">
          <ul id="upperInteractive">
          </ul>
         </div>
         <div class="mod_links">
          <span>
           <a class="c_tx" href="javascript:;" id="navigatorSpan3" rel="prevBlog">
           </a>
          </span>
          |
          <span>
           <a class="c_tx" href="javascript:;" id="navigatorSpan1" rel="nextBlog">
           </a>
          </span>
         </div>
        </div>
       </div>
       <div id="topHintArea">
       </div>
       <script type="text/javascript">
        var g_oBlogData =  {"data":{
"blogid":1435536038,
"voteids":0,
"pubtime":1435536038,
"replynum":0,
"category":"个人日记",
"title":"QTREE6 【树状数组】【倍增祖先】",
"effect":8389121,
"effect2":524294,
"exblogtype":3,
"sus_flag":false,
"friendrelation":[],
"lp_type":0,
"lp_id":81177,
"lp_style":16843520,
"lp_flag":0,
"lp_topvalue":0,
"orguin":251815992,
"orgblogid":1435536038,
"mention_uins":[ ],
"attach":[],"comments":[]}};
       </script>
       <div class="blog_cont">
        <div class="blog_cont_details" id="veryContent" style="height:auto!important">
         <table cellpadding="0" cellspacing="0" id="blogContentTable" style="table-layout:fixed;width:100%;position:relative">
          <tr>
           <td style="word-wrap:break-word" valign="top">
            <div id="blogContainer" style="position:relative; overflow:hidden; height:100%;">
             <div id="blogDetailDiv" style="font-size:14px;">
              <div class="blog_details_20120222">
               <div>
                <div>
                 。。。
                 <a href="http://discuss.codechef.com/questions/31833/qtree6-editorial" target="_blank">
                  http://discuss.codechef.com/questions/31833/qtree6-editorial
                 </a>
                 <br/>
                 吃我一记洛阳铲。。。。
                 <br/>
                 我发现很多人都被我误导了！！（囧。。。
                 <br/>
                 <br/>
                 <img alt="图片" originheight="462" originwidth="310" src="http://a3.qpic.cn/psb?/a7723d22-15e1-452d-817f-ed63333f3d7d/rKBJEF1ZGgOSF8YA9lzUzcK6Kx7GSYCvm.RLVmY6.z4!/b/dNgJ6G7BLQAA&amp;ek=1&amp;kp=1&amp;pt=0&amp;bo=NgHOAQAAAAADAN0!&amp;tl=1&amp;su=0253431889&amp;tm=1584568800&amp;sce=0-12-12&amp;rf=2-9" style="width:300px;height:448px"/>
                 <br/>
                 <br/>
                 <br/>
                 <span>
                  虽然现在洗白已经晚了。。。。。。。还是有必要说一下。。。。
                  <br/>
                  <span>
                   <br/>
                   回忆：
                   <br/>
                   <br/>
                  </span>
                 </span>
                 <p style="border:none;margin-top:0px;margin-bottom:13px;padding:0px;font-size:13px;max-width:700px;font-family:'Trebuchet MS'">
                  suppose you have well known this data structure. Then, we try to apply HLD to this problem. First of all, let’s decompose the tree using HLD. Second, maintain the color and two values (the black/white sub-tree size rooted at this node assuming its color is black/white, despite what color it actually is) on each node u, denoted as Black[u] and White[u].
                 </p>
                 <p style="border:none;margin-top:0px;margin-bottom:13px;padding:0px;font-size:13px;max-width:700px;font-family:'Trebuchet MS'">
                  For each operation 1, starting from node u,
                  <span style="color:rgb(255, 0, 0)">
                   we can upwardly find the lowest (with least depth, all nodes between them are same color) same color node
                  </span>
                  and return the corresponding value stored.
                 </p>
                 <p style="border:none;margin-top:0px;margin-bottom:13px;padding:0px;font-size:13px;max-width:700px;font-family:'Trebuchet MS'">
                  For each operation 2, assume u is changed to black from white. Upwardly find the first black node, denote as v. Then,
                  <span style="color:rgb(255, 0, 0)">
                   subtract White[u] from White[middle], middle are all nodes between u and v (not including u)
                  </span>
                  . After that, the similar things happened to black side again: upwardly find the first white node, denote as v, add Black[u] to Black[middle], middle are all nodes between u and v (not including u).
                 </p>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  All steps introduced above can be supported by maintaining a Segment Tree on each links. For each operation, we can travel along different links upwardly and find the upmost same color node or the first different node. And for the subtraction/addition along the path, it could be done using the "segment cover" operation (with some values stored for the whole segment at segment tree nodes). Therefore, the time complexity can be controlled in O(Qlog^2N), here HLD contributes O(logN) and Segment Tree contributes for the other.
                 </span>
                 <br/>
                 <br/>
                 <br/>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  ————————————————————
                 </span>
                 <br/>
                 <br/>
                 <br/>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  。。。然后我们发现可以延续 QTREE3 的思路。
                 </span>
                </div>
                <div>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  <a href="http://www.spoj.com/problems/QTREE3/en/" target="_blank">
                   http://www.spoj.com/problems/QTREE3/en/
                  </a>
                 </span>
                 <br/>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  。。向上找最低 x 色结点 这件事。。。是可以用 树状数组 + 倍增祖先来做的。。。
                 </span>
                 <br/>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  。。。（。
                 </span>
                 <span>
                  Duality...
                 </span>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  。。  修改一个点会对所有子树中的点产生影响。。
                 </span>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  用树状数组累计这些贡献。
                 </span>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  。。
                  <br/>
                  <span>
                   （。。于是我们可以维护结点到根的路径。。。因此可以用倍增祖先去找最低 x 色结点。。
                  </span>
                 </span>
                </div>
                <div>
                 <br/>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  然后如法炮制。。。。后面那个修改操作也是可以这么弄的。。。。。。
                  <br/>
                  <span>
                   （区间减法。。
                   <br/>
                   <br/>
                  </span>
                 </span>
                 <br/>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  于是这个题就变得非常好写了。。。。。。
                 </span>
                 <br/>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                  <a href="http://www.codechef.com/viewsolution/3075351" target="_blank">
                   http://www.codechef.com/viewsolution/3075351
                  </a>
                 </span>
                 <br/>
                 <br/>
                 <br/>
                 <span style="font-family:'Trebuchet MS';font-size:13px">
                 </span>
                 <span>
                  <span>
                  </span>
                 </span>
                 <br/>
                 <br/>
                 <br/>
                 <br/>
                </div>
                <br/>
                <br/>
                <br/>
                <br/>
               </div>
              </div>
             </div>
            </div>
            <img id="paperPicArea1" src="/ac/b.gif" style="position:relative;display:none;top:auto;"/>
           </td>
          </tr>
         </table>
         <div class="clear" id="paperBottom">
         </div>
        </div>
        <div class="attachment_list bgr2 none" id="attachList">
        </div>
       </div>
       <div class="blog_footer">
        <div class="operate_toolbar">
         <div class="mod_interactive">
          <ul id="footerInteractive">
          </ul>
         </div>
         <div class="mod_links">
          <span>
           <a class="c_tx" href="javascript:void(0)" id="navigatorSpan4" rel="prevBlog">
           </a>
          </span>
          <span>
           <a class="c_tx" href="javascript:void(0)" id="navigatorSpan2" rel="nextBlog">
           </a>
          </span>
         </div>
        </div>
        <div class="mod_tags c_tx3">
         <span class="none" id="categorySpan">
         </span>
         <span class="none" id="rightSettingSpan">
         </span>
         <span class="none" id="contentAuthorSpan">
         </span>
         <span class="blog_tags none" id="tagsSpan">
         </span>
        </div>
        <div class="mod_links c_tx3 none" id="mentionDiv">
        </div>
        <div class="mod_signature">
         <div class="tit">
          <h4>
           签名档
          </h4>
          <a class="c_tx none" href="javascript:void(0)" onclick="InfoManager.modifySignature();return false;" title="">
          </a>
         </div>
         <div class="bor3 cont" id="signatureDIV">
         </div>
         <div class="bor3 cont edit" id="modifySigDiv" style="display:none;">
          <div class="editor">
          </div>
          <p class="btn">
           <button class="bt_tx2" type="button">
            发表
           </button>
           <a class="c_tx" href="javascript:void(0)" title="取消">
            取消
           </a>
          </p>
         </div>
        </div>
        <div class="mod_related_info bbor3" id="recentBlogDIV" style="display:none">
         <div class="mod_title">
          <h4>
           我的热评日志
          </h4>
          <span class="mod_arr" id="ctrl_arr" onclick="InfoScheduler.hideShowRecentBlog(this);return false;">
          </span>
         </div>
         <div class="mod_list">
          <ul id="recentBlogList" style="display:none;">
          </ul>
         </div>
        </div>
        <div class="mod_visitor" id="visitorArea" style="display:none">
        </div>
        <div id="commentListContainer">
        </div>
       </div>
       <div class="op_more bg bor2 op_extend none" id="shareList" style="top:0px;left:0px;">
        <a class="c_tx drop_list" href="javascript:void(0)" id="shareListTitle" onclick="return false;">
         <span class="icon icon_share">
         </span>
         <span class="adjust">
          分享
         </span>
         <span class="mod_arr">
         </span>
        </a>
        <ul id="shareListContainer">
         <li class="bg6_hover none" id="shareBlogContainer">
          <a class="c_tx" href="javascript:void(0)" id="shareBlogBtn" onclick="return false;">
           分享到空间
          </a>
         </li>
         <li class="bg6_hover none" id="tweetBlogContainer">
          <a class="c_tx" href="javascript:void(0)" id="tweetBlogBtn" onclick="return false;">
           转播到微博
          </a>
         </li>
        </ul>
       </div>
       <div class="op_more op_extend op_drop none" id="modifyList" style="top:0px;left:0px;">
        <a class="c_tx bg bor2 drop_list" href="javascript:void(0)" id="modifyListTitle" onclick="return false;">
         <span class="adjust" id="ModifyListAreaDesc">
          更多
         </span>
         <span class="mod_arr">
         </span>
        </a>
        <ul class="bg bor2">
         <li class="none" id="editBlogBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="editBlogBtn" onclick="return false;">
           编辑
          </a>
         </li>
         <li class="none" id="deleteBlogBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="deleteBlogBtn" onclick="return false;">
           删除
          </a>
          <hr class="bbor2"/>
         </li>
         <li class="none" id="complaintBlogBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="complaintBlogBtn" onclick="return false;">
           举报
          </a>
         </li>
         <li class="none" id="useLetterPagerBtn">
          <a class="c_tx bg6_hover" href="javascript:void(0)" onclick="return false;">
           使用该信纸
          </a>
          <hr class="bbor2"/>
         </li>
         <li class="" id="modSizeBtn">
          <div class="mod_size">
           <span class="size_tip">
            字体：
           </span>
           <span class="c_tx2 bg6_hover" id="bigFonts" onclick="return false;">
            大
           </span>
           <span class="c_tx2 bg6 current" id="midFonts" onclick="return false;">
            中
           </span>
           <span class="c_tx2 bg6_hover" id="smallFonts" onclick="return false;">
            小
           </span>
          </div>
          <hr class="bbor2"/>
         </li>
         <li class="none" id="setBlogRightBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="setBlogRightBtn" onclick="return false;">
           权限设置
          </a>
         </li>
         <li class="none" id="setBlogCateBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="setBlogCateBtn" onclick="return false;">
           修改分类
          </a>
         </li>
         <li class="none" id="setRecommendBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="setRecommendBlogBtn" onclick="return false;">
           推荐日志
          </a>
         </li>
         <li class="none" id="setTopBlogBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="setTopBlogBtn" onclick="return false;">
          </a>
         </li>
         <li class="none" id="setPrivateBlogBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="setPrivateBlogBtn" onclick="return false;">
           转为私密日志
          </a>
         </li>
         <li class="none" id="appealBlogBtnContainer">
          <a class="c_tx bg6_hover" href="javascript:void(0)" id="appealtBlogBtn" onclick="return false;">
           申诉
          </a>
         </li>
        </ul>
       </div>
       <div class="bor2 bg3 panel_copy qzblog_copyurl_class none" id="qzblog_copyurl_tip">
        <p>
         <label for="copyUrlInput">
          日志地址:
         </label>
         <input checked="checked" class="bor textinput mod_copyaddress_txt" id="copyUrlInput" readonly="readonly" type="text" value=""/>
        </p>
        <p class="tips">
         请用Ctrl+C复制后贴给好友。
        </p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
 </body>
</html>